<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Sage自留地😎</title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Sage自留地😎" type="application/atom+xml">
</head>
<body>
    <div class="container">
        <header class="header">
    <div class="site-title">
        <a href="/">Sage自留地😎</a>
    </div>
    <div class="nav-toggle">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <nav class="nav">
        <ul class="nav-list">
            
                
                    <li class="nav-item">
                        <a href="/">首页</a>
                    </li>
                
            
                
                    <li class="nav-item has-children">
                        <a href="javascript:void(0);">文章</a>
                        <ul class="nav-submenu">
                            
                                <li class="nav-submenu-item">
                                    <a href="/archives">归档</a>
                                </li>
                            
                                <li class="nav-submenu-item">
                                    <a href="/categories">分类</a>
                                </li>
                            
                                <li class="nav-submenu-item">
                                    <a href="/tags">标签</a>
                                </li>
                            
                        </ul>
                    </li>
                
            
                
                    <li class="nav-item">
                        <a href="/about">关于</a>
                    </li>
                
            
        </ul>
    </nav>
</header>

        <div class="main-container">
            <main class="main-content">
                <article class="post-detail">
    <header class="post-header">
        <h1 class="post-title">【Hacking With Swift】project6_Animation</h1>
        <div class="post-meta">
            <span class="post-date">
                2024-06-21
            </span>
            
                <span class="post-category">
                    <a class="category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
                </span>
            
            
                <span class="post-tags">
                    <a class="tag-none-link" href="/tags/Hacking-with-Swift/" rel="tag">Hacking with Swift</a> <a class="tag-none-link" href="/tags/Swift/" rel="tag">Swift</a> <a class="tag-none-link" href="/tags/%E7%BC%96%E7%A8%8B/" rel="tag">编程</a>
                </span>
            
        </div>
    </header>

    <div class="post-content">
        <p><em><strong><font color=red>英文原博博主是</font></strong></em>   <a target="_blank" rel="noopener" href="https://www.youtube.com/c/PaulHudson">Paul Hudson</a>    <i aria-hidden="true" class="fab fa-twitter" style="color: #4099ff"></i> <a href="https://twitter.com/twostraws" target="_blank">@twostraws</a></p>
<p><em><strong><font color=red>本文是学习Swift过程中翻译该网站的内容:</font></strong></em>   <a target="_blank" rel="noopener" href="https://www.hackingwithswift.com/">https://www.hackingwithswift.com/</a><br>这个项目主要是学习一些简单的SwiftUI中的动画，包括隐式动画（implicit animations），显式动画以及绑定动画。</p>
<h2 id="隐式动画"><a href="#隐式动画" class="headerlink" title="隐式动画"></a>隐式动画</h2><p>隐式动画通过<code>.animation()</code>的modifier指定，每当视图里某个隐式动画的参数改变时，SwiftUI会动画化呈现旧值到新值的变化。这些参数包括尺寸，偏移量，颜色，缩放值，等等。这些修饰器包括<code>scaleEffect</code>,<code>aniamtion</code>,<code>blur</code>,<code>opacity</code>等等。</p>
<p>下面是给一个圆形按钮添加隐式动画的例子</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> animationAmount <span class="operator">=</span> <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line"><span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">.padding(<span class="number">50</span>)</span><br><span class="line">.background(.red)</span><br><span class="line">.foregroundStyle(.white)</span><br><span class="line">.clipShape(.circle)</span><br><span class="line">.scaleEffect(animationAmount)</span><br><span class="line">.blur(radius: (animationAmount <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line">.animation(.default, value: animationAmount)</span><br></pre></td></tr></table></figure>

<h2 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h2><p>上面用到的animation修饰器，里面的参数使用了<code>.defalut</code>。我们也可以使用其他的参数来自定义动画。</p>
<p>可以分别尝试以下的一些例子，在Xcode的预览中，查看效果</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">//animationAmount += 1</span></span><br><span class="line">&#125;</span><br><span class="line">.padding(<span class="number">50</span>)</span><br><span class="line">.background(.red)</span><br><span class="line">.foregroundColor(.white)</span><br><span class="line">.clipShape(<span class="type">Circle</span>())</span><br><span class="line"><span class="comment">//.scaleEffect(animationAmount)</span></span><br><span class="line">.overlay(<span class="type">Circle</span>()</span><br><span class="line">    .stroke(.red)</span><br><span class="line">    .scaleEffect(animationAmount)</span><br><span class="line">    .opacity(<span class="number">2</span> <span class="operator">-</span> animationAmount)</span><br><span class="line">    .animation(.easeInOut(duration: <span class="number">1</span>).repeatForever(autoreverses: <span class="literal">false</span>), value: animationAmount) <span class="comment">//使用repeatforever制作连续动画</span></span><br><span class="line">    .onAppear&#123;</span><br><span class="line">        animationAmount <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">.animation(.interpolatingSpring(stiffness: <span class="number">50</span>, damping: <span class="number">1</span>), value: animationAmount) <span class="comment">//弹簧动画，快速放大然后反弹</span></span><br><span class="line">.animation(.default, value: animationAmount)</span><br><span class="line">.animation(.easeOut, value: animationAmount)</span><br><span class="line">.blur(radius: (animationAmount <span class="operator">-</span> <span class="number">1</span> ) <span class="operator">*</span> <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">.animation(.easeInOut(duration: <span class="number">2</span>), value: animationAmount) <span class="comment">//持续两秒的缓入缓出动画</span></span><br><span class="line">.animation(.easeOut(duration: <span class="number">2</span>).delay(<span class="number">1</span>), value: animationAmount) <span class="comment">//点击按钮现在将等待一秒钟，然后再执行两秒钟的动画。</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，要把<code>.animation</code>放在修饰器最后，这样那些缩放，尺寸变化等动画才能够生效。</p>
<h2 id="动画绑定"><a href="#动画绑定" class="headerlink" title="动画绑定"></a>动画绑定</h2><p>我们可以将隐式动画中的参数与其他控件绑定，比如和步进器<code>stepper</code>绑定，这样每次点击Stepper的按钮时候，添加了动画的按钮会根据变化的值去调整当前状态，这个过程将会以动画形式呈现。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(animationAmount)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Stepper</span>(<span class="string">&quot;Scale amount&quot;</span>, value: <span class="variable">$animationAmount</span>.animation(.easeOut(duration: <span class="number">1</span>)</span><br><span class="line">                .repeatCount(<span class="number">3</span>, autoreverses: <span class="literal">true</span>)), in: <span class="number">1</span><span class="operator">...</span><span class="number">10</span>, step: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">                animationAmount <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">40</span>)</span><br><span class="line">            .background(.red)</span><br><span class="line">            .foregroundStyle(.white)</span><br><span class="line">            .clipShape(.circle)</span><br><span class="line">            .scaleEffect(animationAmount)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建显式动画"><a href="#创建显式动画" class="headerlink" title="创建显式动画"></a>创建显式动画</h2><p>我们现在能够通过将<code>animation()</code>修饰符附加到视图来创建隐式动画，以及它如何让我们通过将<code>animation()</code>修饰符添加到绑定来创建动画绑定更改，除此之外，我们还可以通过<code>withAnimation()</code>闭包来创建显式动画。</p>
<p>首先还是创建一个简单的按钮，并为他添加一个3D旋转的修饰符<code>rotation3DEffect()</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">    .padding(<span class="number">50</span>)</span><br><span class="line">    .background(.red)</span><br><span class="line">    .foregroundStyle(.white)</span><br><span class="line">    .clipShape(.circle)</span><br><span class="line">    .rotation3DEffect(.degrees(animationAmount), axis: (x: <span class="number">0</span>, y: <span class="number">1</span>, z: <span class="number">0</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们现在希望给Button添加一个动作，来修改<code>animationAmount</code>这个参数。如果直接编写<code>animationAmount += 360</code>，那么更改将立即发生，因为按钮没有附加动画修改器。这就是显式动画的用武之地：如果我们使用<code>withAnimation()</code>闭包，那么 SwiftUI 将确保由新状态引起的任何变化都将自动进行动画处理。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">        withAnimation &#123;</span><br><span class="line">            animationAmount <span class="operator">+=</span> <span class="number">360</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//            withAnimation(.spring(duration: 2, bounce: 0.5)) &#123;</span></span><br><span class="line"><span class="comment">//                animationAmount += 360</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">        <span class="comment">// do nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">    .padding(<span class="number">50</span>)</span><br><span class="line">    .background(.red)</span><br><span class="line">    .foregroundStyle(.white)</span><br><span class="line">    .clipShape(.circle)</span><br><span class="line">    .rotation3DEffect(.degrees(animationAmount), axis: (x: <span class="number">1</span>, y: <span class="number">1</span>, z: <span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line">```withAnimation()可以给一个动画参数，使用你可以在 <span class="type">SwiftUI</span> 的其他地方使用的所有相同的动画<span class="operator">。</span>例如，我们可以使用withAnimation()如下调用使我们的旋转效果使用弹簧动画：</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">withAnimation(.interpolatingSpring(stiffness: <span class="number">5</span>, damping: <span class="number">1</span>)) &#123;</span><br><span class="line">    animationAmount <span class="operator">+=</span> <span class="number">360</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or </span></span><br><span class="line">withAnimation(.spring(duration: <span class="number">1</span>, bounce: <span class="number">0.5</span>)) &#123;</span><br><span class="line">                animationAmount <span class="operator">+=</span> <span class="number">360</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<h2 id="控制动画堆栈"><a href="#控制动画堆栈" class="headerlink" title="控制动画堆栈"></a>控制动画堆栈</h2><p>我们之前研究过修饰符位置以及顺序的重要性，比如下面两组代码表现出来的样式就是不同的。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">.background(.blue)</span><br><span class="line">.frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">.foregroundStyle(.white)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// do nothing</span></span><br><span class="line">&#125;</span><br><span class="line">.frame(width: <span class="number">200</span>, height: <span class="number">200</span>)    </span><br><span class="line">.background(.blue)</span><br><span class="line">.foregroundStyle(.white)</span><br></pre></td></tr></table></figure>
<p>这是因为如果我们在调整框架之前给背景着色，那么只有原始空间被着色，而不是扩展的空间。如果你还记得，其根本原因是 SwiftUI 使用修饰符包裹视图的方式，允许我们多次应用相同的修饰符——我们重复<code>background()</code>和<code>padding()</code>多次创建条纹边框效果。 </p>
<p>这其实告诉我们，修饰符的顺序很重要，因为 SwiftUI 按照修饰符的应用顺序包装视图。 </p>
<p>我们为按钮添加一些修饰器，让他根据某些状态显示不同的颜色</p>
<p>运行下面代码，你会看到点击按钮会使其颜色在蓝色和红色之间变化，这个过程是连续的，而不是由红色直接切换到蓝色。 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">    enabled.toggle()</span><br><span class="line">&#125;</span><br><span class="line">.frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">.background(enabled <span class="operator">?</span> .blue : .red)</span><br><span class="line">.animation(<span class="literal">nil</span>, value: enabled)</span><br></pre></td></tr></table></figure>
<p>运行下面代码，你会看到点击按钮会使其颜色在蓝色和红色之间变化的同时，形状也随之发生改变，并且被我们附加了一个跳动的特效。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> animationAmount <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> enabled <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">        enabled.toggle()</span><br><span class="line">    &#125;</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .background(enabled <span class="operator">?</span> .blue : .red)</span><br><span class="line">    .animation(.default, value: enabled)</span><br><span class="line">    .foregroundStyle(.white)</span><br><span class="line">    .clipShape(.rect(cornerRadius: enabled <span class="operator">?</span> <span class="number">60</span> : <span class="number">0</span>))</span><br><span class="line">    .animation(.spring(duration: <span class="number">1</span>, bounce: <span class="number">0.6</span>), value: enabled)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>你会看到，如果我们应用多个animation()修改器，每个修改器都会控制它之前的所有内容，直到下一个动画。这允许我们以各种不同的方式为状态变化设置动画，而不是对所有属性都使用同一种动画。</p>
<p>比如对于上面的代码，如果你只希望形状上的变化使用动画，而希望颜色直接变化，可以把第一个<code>.animation</code>中的<code>.deault</code>改为<code>nil</code>，这样，颜色变化的动画就被完全禁用掉了，而下一个形状变化的动画不受影响。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> animationAmount <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line"><span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> enabled <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">        enabled.toggle()</span><br><span class="line">    &#125;</span><br><span class="line">    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">    .background(enabled <span class="operator">?</span> .blue : .red)</span><br><span class="line">    .animation(<span class="literal">nil</span>, value: enabled)</span><br><span class="line">    .foregroundStyle(.white)</span><br><span class="line">    .clipShape(.rect(cornerRadius: enabled <span class="operator">?</span> <span class="number">60</span> : <span class="number">0</span>))</span><br><span class="line">    .animation(.spring(duration: <span class="number">1</span>, bounce: <span class="number">0.6</span>), value: enabled)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="动画手势"><a href="#动画手势" class="headerlink" title="动画手势"></a>动画手势</h2><p>SwiftUI 允许我们将手势附加到任何视图，并且这些手势的效果也可以是动画的。我们可以使用一系列手势，例如点击手势让任何视图响应点击，拖动手势响应我们在视图上拖动手指，等等。 </p>
<p>稍后我们会更详细地研究手势，但现在让我们尝试一些相对简单的事情：一张我们可以在屏幕上拖动的卡片，但当我们放手时它会弹回到原来的位置。 </p>
<p>首先在屏幕中央绘制一个类似卡片的视图。 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LinearGradient</span>(colors: [.yellow, .red], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">            .frame(width: <span class="number">300</span>, height: <span class="number">200</span>)</span><br><span class="line">            .clipShape(.rect(cornerRadius: <span class="number">10</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想要根据手指的位置在屏幕上移动它，需要存储拖动量，并用<code>.offset()</code>修饰符来移动，它让我们可以调整视图的 X 和 Y 坐标，而无需移动它周围的其他视图。如果愿意，你可以传入离散的 X 和 Y 坐标， offset()也可以直接采用CGSize。 </p>
<p>这些创建完后，我们就要做最重要的手势部分了——创建一个<code>DragGesture</code>并将其附加到卡片上。拖动手势有两个对我们有用的额外修饰符：<code>onChanged()</code>让我们在用户移动手指时运行闭包，<code>onEnded()</code>让我们在用户将手指离开屏幕时运行闭包，从而结束拖动。  </p>
<p>现在，你的代码应该是这样的,如果使用隐式表达，后面需要加上<code>.animation</code>的修饰符。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> dragAmount <span class="operator">=</span> <span class="type">CGSize</span>.zero</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">LinearGradient</span>(colors: [.yellow, .red], startPoint: .topLeading, endPoint: .bottomTrailing)</span><br><span class="line">            .frame(width: <span class="number">300</span>, height: <span class="number">200</span>)</span><br><span class="line">            .clipShape(.rect(cornerRadius: <span class="number">10</span>))</span><br><span class="line">            .offset(dragAmount)</span><br><span class="line">            .gesture(</span><br><span class="line">                <span class="type">DragGesture</span>()</span><br><span class="line">                    .onChanged &#123; dragAmount <span class="operator">=</span> <span class="variable">$0</span>.translation &#125; <span class="comment">//拖拽的时候是没有动画的</span></span><br><span class="line">                    .onEnded &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                        withAnimation(.bouncy) &#123;</span><br><span class="line">                            dragAmount <span class="operator">=</span> .zero</span><br><span class="line">                        &#125;     <span class="comment">//只有释放的时候有动画，显式动画</span></span><br><span class="line">                    &#125;</span><br><span class="line">            )</span><br><span class="line">            <span class="comment">//.animation(.bouncy, value: dragAmount)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>试着预览一下，看看效果如何吧。</p>
<p>下面我们将偏移动画与拖动手势和一点延迟相结合，我们就可以创建非常有趣的动画而无需大量代码。 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> letters <span class="operator">=</span> <span class="type">Array</span>(<span class="string">&quot;Hello SwiftUI&quot;</span>)</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> enabled <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> dragAmount <span class="operator">=</span> <span class="type">CGSize</span>.zero</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>(spacing: <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span>letters.count, id: \.<span class="keyword">self</span>) &#123; num <span class="keyword">in</span></span><br><span class="line">                <span class="type">Text</span>(<span class="type">String</span>(letters[num]))</span><br><span class="line">                    .padding(<span class="number">5</span>)</span><br><span class="line">                    .font(.title)</span><br><span class="line">                    .background(enabled <span class="operator">?</span> .blue : .red)</span><br><span class="line">                    .offset(dragAmount)</span><br><span class="line">                    .animation(.linear.delay(<span class="type">Double</span>(num) <span class="operator">/</span> <span class="number">20</span>), value: dragAmount)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .gesture(</span><br><span class="line">            <span class="type">DragGesture</span>()</span><br><span class="line">                .onChanged &#123; dragAmount <span class="operator">=</span> <span class="variable">$0</span>.translation &#125;</span><br><span class="line">                .onEnded &#123; <span class="keyword">_</span> <span class="keyword">in</span></span><br><span class="line">                    dragAmount <span class="operator">=</span> .zero</span><br><span class="line">                    enabled.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拖拽的时候，字母会跟着轨迹蛇形游动，并在释放的时候变换颜色。</p>
<h2 id="使用transitions显示或隐藏视图"><a href="#使用transitions显示或隐藏视图" class="headerlink" title="使用transitions显示或隐藏视图"></a>使用transitions显示或隐藏视图</h2><p>SwiftUI 最强大的功能之一是能够自定义视图显示和隐藏的方式。之前您已经了解了我们如何使用常规if条件来有条件地包含视图，这意味着当该条件发生变化时，我们可以在我们的视图层次结构中插入或删除视图。</p>
<p>Transitions 控制这种插入和移除是如何发生的，我们可以使用内置的 transitions，以不同的方式组合它们，甚至创建完全自定义的 transitions。 </p>
<p>我们设置一个按钮和一个矩形，并让矩形只有在满足某个条件时才会出现，然后用按钮控制它的出现和消失。 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShowingRed <span class="operator">=</span> <span class="literal">false</span>    <span class="comment">//定义矩形是否出现的状态</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Button</span>(<span class="string">&quot;Tap Me&quot;</span>) &#123;</span><br><span class="line">                <span class="comment">//isShowingRed.toggle()</span></span><br><span class="line">                withAnimation &#123;</span><br><span class="line">                    isShowingRed.toggle()      <span class="comment">//使用按钮切换矩形显示状态</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// do nothing</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> isShowingRed &#123;        <span class="comment">//显示条件</span></span><br><span class="line">                <span class="type">Rectangle</span>()</span><br><span class="line">                    .fill(.red)</span><br><span class="line">                    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">                    <span class="comment">//.transition(.scale)</span></span><br><span class="line">                    <span class="comment">//.transition(.asymmetric(insertion: .scale, removal: .opacity))</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用transition可以通过不同参数来控制变换的样式。我们可以让矩形按比例放大和缩小 ，也可以<br>尝试其他一些过渡。一个有用的是<code>.asymmetric</code>，它让我们可以在显示视图时使用一种转换，而在视图消失时使用另一种转换 （见上方代码注释部分）。</p>
<h2 id="使用ViewModifier构建自定义转换"><a href="#使用ViewModifier构建自定义转换" class="headerlink" title="使用ViewModifier构建自定义转换"></a>使用ViewModifier构建自定义转换</h2><p>为 SwiftUI 创建全新的过渡是可能的——而且实际上非常容易——允许我们使用完全自定义的动画添加和删除视图。</p>
<p>这个功能是通过<code>.modifier</code>转换实现的，它接受我们想要的任何视图修饰符。问题是我们需要能够实例化修饰符，这意味着它需要是我们自己创建的。</p>
<p>为了尝试这一点，我们可以编写一个视图修改器，让我们模仿 Keynote 中的 Pivot 动画——它会导致一张新幻灯片从其左上角向内旋转。在 SwiftUI 中，这意味着创建一个视图修改器，使我们的视图从一个角向内旋转，而不会脱离它应该位于的边界。SwiftUI 实际上为我们提供了修改器来做到这一点：<code>rotationEffect()</code>让我们在 2D 空间中旋转视图, 和<code>clipped()</code>停止在其矩形空间之外绘制视图。</p>
<p><code>rotationEffect()</code>类似于<code>rotation3DEffect()</code>，只是它始终围绕 Z 轴旋转。然而，它也让我们能够控制旋转的锚点——视图的哪一部分应该固定在适当的位置作为旋转的中心。SwiftUI 为我们提供了UnitPoint一种用于控制锚点的类型，它让我们可以为旋转指定一个精确的 X&#x2F;Y 点，或者使用许多内置选项中的一个—— &#96;&#96;.topLeading<code>、</code>.bottomTrailing<code>、</code>.center&#96;等等。</p>
<p>让我们通过创建一个结构将所有这些放入代码中，该CornerRotateModifier结构具有一个锚点来控制旋转应该发生的位置，以及一个数量来控制应该应用多少旋转： </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CornerRotateModifier</span>: <span class="title class_">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> amount: <span class="type">Double</span></span><br><span class="line">    <span class="keyword">let</span> anchor: <span class="type">UnitPoint</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content</span><br><span class="line">            .rotationEffect(.degrees(amount), anchor: anchor)</span><br><span class="line">            .clipped()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加clipped()意味着当视图旋转时，位于其自然矩形之外的部分不会被绘制。</p>
<p>我们可以直接使用.modifier转换来尝试，但它有点笨拙。一个更好的主意是将其包装在 AnyTransition的扩展名中，使其在其顶部前角从 -90 旋转到 0： </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">AnyTransition</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> pivot: <span class="type">AnyTransition</span> &#123;</span><br><span class="line">        .modifier(</span><br><span class="line">            active: <span class="type">CornerRotateModifier</span>(amount: <span class="operator">-</span><span class="number">90</span>, anchor: .topLeading),</span><br><span class="line">            identity: <span class="type">CornerRotateModifier</span>(amount: <span class="number">0</span>, anchor: .topLeading)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如，我们可以使用onTapGesture()修改器在屏幕上创建一个红色矩形枢轴，如下所示： </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ContentView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> isShowingRed <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="type">Rectangle</span>()</span><br><span class="line">                .fill(.blue)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> isShowingRed &#123;</span><br><span class="line">                <span class="type">Rectangle</span>()</span><br><span class="line">                    .fill(.red)</span><br><span class="line">                    .frame(width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">                    .transition(.pivot)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        .onTapGesture &#123;</span><br><span class="line">            withAnimation &#123;</span><br><span class="line">                isShowingRed.toggle()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



    </div>

    <footer class="post-footer">
        <div class="post-nav">
            
                <div class="post-nav-prev">
                    <span>上一篇</span>
                    <a href="/article/46793.html">【Hacking With Swift】project7_iExpense</a>
                </div>
            
            
                <div class="post-nav-next">
                    <span>下一篇</span>
                    <a href="/article/41438.html">【Hacking With Swift】project5_WordScramble</a>
                </div>
            
        </div>
    </footer>

    
        <div class="post-comments">
            <h3 class="comments-title">评论</h3>
            <div id="waline"></div>
        </div>
    
</article>


    <script type="module">
        import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

        init({
            el: '#waline',
            serverURL: 'https://walinecomments.five2fire.top',
            dark: 'auto',
            lang: 'zh-CN',
            pageview: true,
            comment: true,
            emoji: ["https://unpkg.com/@waline/emojis@1.1.0/weibo","https://unpkg.com/@waline/emojis@1.1.0/bilibili"]
        });
    </script>
    <link rel="stylesheet" href="https://unpkg.com/@waline/client@v3/dist/waline.css" />



            </main>
        </div>
        
    </div>
    
<script src="/js/main.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
</body>
</html>
